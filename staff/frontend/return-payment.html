<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô | ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/return_payment.css">
</head>

<body>

<header class="main-header">
    <div class="header-top">
        <div class="brand">
            <span class="brand-name">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤</span>
            <small>Sports Equipment Booking System</small>
        </div>
        <div class="user-zone">
            <a href="profile.html" class="profile-btn">üë§ ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</a>
        </div>
    </div>

    <div class="header-bottom">
        <nav class="main-nav">
            <a href="index.html" class="nav-item">‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
            <a href="bookings.html" class="nav-item">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤</a>
            <a href="return.html" class="nav-item active">‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
            <a href="history_point.html" class="nav-item">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
        </nav>
    </div>
</header>

<main class="payment-wrapper">

    <div class="payment-panel">

        <h2>‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>

        <div class="booking-info">
            Booking:
            <strong id="bookingCode">-</strong>
        </div>

        <div class="amount-box">
            <p>‡∏¢‡∏≠‡∏î‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö</p>
            <h1 id="penaltyAmount">0 ‡∏ö‡∏≤‡∏ó</h1>
        </div>

        <div class="qr-section">
            <img id="qrImg"
                 src="/sports_rental_system/uploads/qr_promptpay.jpg">
            <small>‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏™‡πÅ‡∏Å‡∏ô QR ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î ‚Äú‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß‚Äù</small>
        </div>

        <button id="confirmBtn" class="btn-primary">
            ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß
        </button>

    </div>

</main>

<script>

console.log("üî• RETURN PENALTY PAYMENT READY üî•");

const params = new URLSearchParams(window.location.search);
const code = params.get("code");
const penalty = params.get("penalty");

const bookingEl = document.getElementById("bookingCode");
const amountEl = document.getElementById("penaltyAmount");
const confirmBtn = document.getElementById("confirmBtn");

if (!code || !penalty) {
    alert("‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö");
    window.location.href = "return.html";
}

bookingEl.textContent = code;
amountEl.textContent = parseFloat(penalty).toFixed(2) + " ‡∏ö‡∏≤‡∏ó";

confirmBtn.addEventListener("click", function () {

    const ok = confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ß‡πà‡∏≤‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß?");
    if (!ok) return;

    confirmBtn.disabled = true;
    confirmBtn.textContent = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";

    fetch(
        "/sports_rental_system/staff/api/confirm_return_penalty.php",
        {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            credentials: "include",
            body: JSON.stringify({ booking_code: code })
        }
    )
    .then(r => r.json())
    .then(res => {

        if (!res.success) {
            alert(res.message || "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
            confirmBtn.disabled = false;
            confirmBtn.textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß";
            return;
        }

        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
        window.location.href = "return.html";
    })
    .catch(() => {
        alert("‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
        confirmBtn.disabled = false;
        confirmBtn.textContent = "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß";
    });

});

</script>

</body>
</html>
